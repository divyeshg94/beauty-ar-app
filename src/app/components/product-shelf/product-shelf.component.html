<div class="product-shelf-container" [class.collapsed]="isCollapsed">
  <!-- Collapse Toggle Button -->
  <button class="collapse-toggle" (click)="toggleCollapse()" [title]="isCollapsed ? 'Expand' : 'Collapse'">
    <svg class="toggle-icon" [class.rotated]="isCollapsed" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
    </svg>
  </button>

  <!-- Category Tabs -->
  <div class="category-tabs">
    <button 
      *ngFor="let category of categories" 
      (click)="selectCategory(category)"
      [class.active]="category === selectedCategory"
      class="category-tab">
      {{ getCategoryDisplayName(category) }}
    </button>
  </div>

  <!-- Products Carousel -->
  <div class="product-carousel" *ngIf="!isCollapsed">
    <div *ngIf="isApplying" class="empty-state">
      <p>{{ applyMessage || 'In progress…' }}</p>
    </div>

    <div *ngIf="applyError" class="empty-state" style="color: #fca5a5;">
      <p>{{ applyError }}</p>
    </div>

    <div 
      *ngFor="let product of products" 
      (click)="applyProduct(product)"
      [style.pointer-events]="isApplying ? 'none' : 'auto'"
      [style.opacity]="isApplying ? 0.6 : 1"
      [class.applied]="isApplied(product.id)"
      class="product-card">
      <div class="product-image">
        <div class="color-swatch" [style.background-color]="product.colorHex"></div>
        <div *ngIf="isApplied(product.id)" class="applied-checkmark">
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
          </svg>
        </div>
      </div>
      <div class="product-info">
        <p class="product-name">{{ product.shade }}</p>
        <p class="product-brand">{{ product.brand }}</p>
      </div>
    </div>

    <!-- Empty state -->
    <div *ngIf="!isApplying && products.length === 0" class="empty-state">
      <p>No products in this category</p>
    </div>
  </div>

  
</div>

